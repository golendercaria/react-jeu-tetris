(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{12:function(e,t,n){e.exports=n(23)},17:function(e,t,n){},18:function(e,t,n){},19:function(e,t,n){},20:function(e,t,n){},23:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(10),o=n.n(i),s=(n(17),n(2)),c=n(3),l=n(5),u=n(4),p=n(6);n(18);var d=function(e){var t=e.actions;return r.a.createElement("div",{id:"menu"},r.a.createElement("h1",null,"Tetris"),r.a.createElement("button",{onClick:function(){return t.launchGame()}},"Play"),r.a.createElement("button",{onClick:function(){return t.launchOptions()}},"Options"))},m=n(7),h=n(11);var v=function(e){var t=e.grid,n=e.piece,a=e.projection;t=function(e){for(var t=e[e.length-1],n=e.length-2;n>-1;n--){for(var a=0;a<e[0].length;a++)e[n][a]<=0&&0!==t[a]&&(e[n][a]=-1*Math.abs(t[a]));t=e[n]}return e}(t);var i=[];return n&&a&&(i=function(e,t){for(var n=[],a=[],r=t.posY;r<e.length;r++){n=a,a=[];for(var i=0;i<t.grid.length;i++)for(var o=0;o<t.grid[0].length;o++)if(t.grid[i][o]>0){if(void 0===e[i+r])return n;if(e[i+r][o+t.posX]>0)return n;a.push(i+r+"_"+(o+t.posX))}}return a}(t,n)),r.a.createElement("div",{id:"grid",className:"grid"},t.map(function(e,a){return e.map(function(e,o){var s=[];return 0===o&&s.push("first"),null!==n&&-1!==n.mergeData.indexOf(a+"_"+o)&&s.push("color-"+n.color),t[a][o]<0&&(s.push("colorizedEmptyCellule"+t[a][o]),t[a][o]=0),-1!==i.indexOf(a+"_"+o)&&s.push("projection"),t[a][o]>0&&s.push("color-"+t[a][o]),r.a.createElement("span",{key:o+"_"+a,className:s.join(" ")})})}))},f=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,0],[0,1,0],[1,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,0,0],[0,1,1],[1,1,0]],[[0,0,0],[1,1,0],[0,1,1]],[[1,1],[1,1]]];var g=function(e){var t=e.grid,n=e.color;return r.a.createElement("div",{id:"wrapper_next_piece"},r.a.createElement("span",{className:"title"},"NEXT PIECE"),r.a.createElement("div",{id:"next_piece",className:"grid"},t.map(function(e,a){return e.map(function(e,i){var o=[];return 0===i&&o.push("first"),t[a][i]>0&&o.push("color-"+n),r.a.createElement("span",{key:i+"_"+a,className:o.join(" ")})})})))};var E=function(e){var t=e.lvl,n=e.line,a=e.linePerLvl;return r.a.createElement("div",{id:"level_and_line",className:"ui-text"},r.a.createElement("div",{className:"lvl"},r.a.createElement("span",{className:"title"},"LEVEL"),r.a.createElement("span",{className:"value"},t)),r.a.createElement("div",{className:"line"},r.a.createElement("span",{className:"title"},"LINE"),r.a.createElement("span",{className:"value"},n,"/",a)))};var k=function(e){var t=e.score,n=e.globalTimer;return r.a.createElement("div",{id:"time_and_score",className:"ui-text"},r.a.createElement("div",{className:"time"},r.a.createElement("span",{className:"title"},"TIME"),r.a.createElement("span",{className:"value"},function(e){var t=e,n=Math.floor(t/3600),a=Math.floor((t-3600*n)/60),r=t-3600*n-60*a;return a<10&&(a="0"+a),r<10&&(r="0"+r),n>0?(n<10&&(n="0"+n),n+":"+a+":"+r):a+":"+r}(n))),r.a.createElement("div",{className:"score"},r.a.createElement("span",{className:"title"},"SCORE"),r.a.createElement("span",{className:"value"},t.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1."))))},y={touch:{bottom:40,left:37,right:39,rotateLeft:89,rotateRight:88},helpers:{projection:!0}},b=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={grid:null,gridHeight:20,gridWidth:10,piece:null,nbrCleanLine:0,lvl:1,nextPieceIndex:null,isLostGame:!1,options:{},score:0,linePerLvl:5},n.executeKeyCode=function(e){switch(e){case n.state.options.touch.right:n.pieceMoveToXAxis(1);break;case n.state.options.touch.left:n.pieceMoveToXAxis(-1);break;case n.state.options.touch.bottom:n.pieceMoveToYAxis(1);break;case n.state.options.touch.rotateRight:n.rotatePiece("right");break;case n.state.options.touch.rotateLeft:n.rotatePiece("left")}},n.keyupActions=function(e){n.multiple_key_pressed=!1;var t=n.key_pressed.indexOf(e.keyCode);-1!==t&&n.key_pressed.splice(t,1)},n.keydownActions=function(e){-1===n.key_pressed.indexOf(e.keyCode)&&n.key_pressed.push(e.keyCode),n.key_pressed.length>1?n.key_pressed.forEach(function(e,t){!1===n.multiple_key_pressed&&0===t?n.multiple_key_pressed=!0:n.executeKeyCode(e)}):n.executeKeyCode(n.key_pressed[0])},n.initGame=function(){n.baseIntervalTimer=1e3,n.globalTimer=0,setInterval(function(){n.globalTimer++},1e3),n.key_pressed=[],n.multiple_key_pressed=!1,window.addEventListener("keyup",n.keyupActions),window.addEventListener("keydown",n.keydownActions),n.setState({grid:n.buildGrid(),nextPieceIndex:n.generateNextPieceIndex(),nbrCleanLine:0,lvl:1,isLostGame:!1,score:0},function(){n.generatePiece(),n.launchTimer()})},n.lostGame=function(){clearInterval(n.timer),n.setState({isLostGame:!0}),window.removeEventListener("keyup",n.keyupActions),window.removeEventListener("keydown",n.keydownActions)},n.launchTimer=function(){n.timer=setInterval(function(){n.pieceMoveToYAxis(1)},n.convertLvlToTime())},n.convertLvlToTime=function(){var e=n.baseIntervalTimer-35*(n.state.lvl-1);return e<100?100:e},n.buildGrid=function(){for(var e=[],t=0;t<n.state.gridHeight;t++){for(var a=[],r=0;r<n.state.gridWidth;r++)a.push(0);e.push(a)}return e},n.mergePieceToGrid=function(){var e=n.state.score,t=n.state.lvl,a=!1,r=n.state.grid,i=n.state.nbrCleanLine;n.state.piece.mergeData.forEach(function(e){var t=e.split("_"),a=Object(h.a)(t,2),i=a[0],o=a[1];r[i][o]=n.state.piece.color});var o=n.cleanGrid(r),s=o.cleanGrid,c=o.nbrLineCompleted;i+=c,c>0&&(e+=parseInt(Math.pow(c,2)*t*n.convertLvlToTime()),i>=n.state.linePerLvl&&(i=0,t++,a=!0,clearInterval(n.timer))),n.setState({grid:s,piece:null,nbrCleanLine:i,lvl:t,score:e},function(){n.generatePiece(),a&&n.launchTimer()})},n.generatePiece=function(){var e={posY:0},t=n.state.nextPieceIndex;e.color=t+1,e.grid=f[t],0===e.grid[0][0]&&e.posY--,e.posX=Math.floor((n.state.gridWidth-e.grid[0].length)/2),e.mergeData=[];var a=n.pieceCanBeMove(e);!1!==a?(e.mergeData=a,n.setState({piece:e,nextPieceIndex:n.generateNextPieceIndex()})):n.lostGame()},n.pieceCanBeMove=function(e){for(var t=[],a=0;a<e.grid.length;a++)for(var r=0;r<e.grid[0].length;r++)if(e.grid[a][r]>0){if(void 0===n.state.grid[a+e.posY])return!1;if(void 0===n.state.grid[a+e.posY][r+e.posX])return!1;if(n.state.grid[a+e.posY][r+e.posX]>0)return!1;t.push(a+e.posY+"_"+(r+e.posX))}return t},n.pieceMoveToXAxis=function(e){var t=Object(m.a)({},n.state.piece);if(null===t)return!1;t.posX+=e;var a=n.pieceCanBeMove(t);!1!==a&&(t.mergeData=a,n.setState({piece:t}))},n.pieceMoveToYAxis=function(e){var t=Object(m.a)({},n.state.piece);if(null===t)return!1;t.posY+=e;var a=n.pieceCanBeMove(t);!1!==a?(t.mergeData=a,n.setState({piece:t})):n.mergePieceToGrid()},n.rotatePiece=function(e){var t=Object(m.a)({},n.state.piece);if(null===t)return!1;var a=[];if("right"===e)for(var r=0;r<t.grid[0].length;r++){for(var i=[],o=t.grid.length-1;o>-1;o--)i.push(t.grid[o][r]);a.push(i)}else if("left"===e)for(var s=t.grid[0].length-1;s>-1;s--){for(var c=[],l=0;l<t.grid.length;l++)c.push(t.grid[l][s]);a.push(c)}t.grid=a;var u=n.pieceCanBeMove(t);if(!1!==u)t.mergeData=u,n.setState({piece:t});else{var p=!1;t.posX<0?(t.posX=0,p=!0):t.grid[0].length+t.posX>n.state.gridWidth?(t.posX=n.state.gridWidth-t.grid[0].length,p=!0):t.posY<0&&(t.posY=0,p=!0),p&&!1!==(u=n.pieceCanBeMove(t))&&(t.mergeData=u,n.setState({piece:t}))}},n.cleanGrid=function(e){for(var t,a=[],r=0;r<n.state.gridHeight;r++){for(var i=!0,o=0;o<n.state.gridWidth;o++)0===e[r][o]&&(i=!1);!1===i&&a.push(e[r])}t=n.state.gridHeight-a.length;for(var s=0;s<t;s++)a.unshift(n.makeCleanLine(n.state.gridWidth));return{cleanGrid:a,nbrLineCompleted:t}},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=JSON.parse(localStorage.getItem("tetris_options"));null!==t&&""!==t||(t=y),this.setState({options:t},function(){e.initGame()})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keyup",this.keyupActions),window.removeEventListener("keydown",this.keydownActions)}},{key:"generateNextPieceIndex",value:function(){return Math.floor(Math.random()*f.length)}},{key:"makeCleanLine",value:function(e){for(var t=[],n=0;n<e;n++)t.push(0);return t}},{key:"render",value:function(){var e=this;return this.state.isLostGame?r.a.createElement("div",{id:"wrapper_lost_game"},r.a.createElement("h2",null,"Game Over"),r.a.createElement("div",{className:"score"},"Score : ",this.state.score),r.a.createElement("div",{id:"menu"},r.a.createElement("button",{onClick:function(){return e.props.actions.launchMenu()}},"Back"),r.a.createElement("button",{onClick:function(){return e.initGame()}},"Play again"))):r.a.createElement("div",{id:"wrapper_grid"},r.a.createElement(E,{lvl:this.state.lvl,line:this.state.nbrCleanLine,linePerLvl:this.state.linePerLvl}),null!==this.state.nextPieceIndex&&r.a.createElement(g,{grid:f[this.state.nextPieceIndex],color:this.state.nextPieceIndex+1}),null!==this.state.grid&&r.a.createElement(v,{grid:this.state.grid,piece:this.state.piece,projection:this.state.options.helpers.projection}),r.a.createElement(k,{score:this.state.score,globalTimer:this.globalTimer}))}}]),t}(a.Component);n(19);var w=function(e){var t=e.message,n=e.active;return r.a.createElement("div",{id:"modal",className:!0===n?"open":""},r.a.createElement("div",{className:"mask"}),r.a.createElement("div",{className:"container auto"},r.a.createElement("div",{className:"message"},t),r.a.createElement("button",{className:"close"},"\xd7")))},L=(n(20),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={options:{touch:{bottom:40,left:37,right:39,rotateLeft:89,rotateRight:88},helpers:{projection:!0}},captureTouch:!1,modalActive:!1},n.keydownActions=function(e){if(!1!==n.state.captureTouch){var t=n.state.options.touch;t[n.state.captureTouch]=e.keyCode,n.setState({touch:t,captureTouch:!1,modalActive:!1})}},n.updateTouch=function(e){n.setState({captureTouch:e,modalActive:!0})},n.updateHelper=function(e){var t=n.state.options.helpers;!0===t[e]?t[e]=!1:t[e]=!0,n.setState({helpers:t})},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=JSON.parse(localStorage.getItem("tetris_options"));null!==t&&""!==t||(t=y),this.setState({options:t},function(){window.addEventListener("keydown",e.keydownActions)})}},{key:"componentWillUnmount",value:function(){localStorage.setItem("tetris_options",JSON.stringify(this.state.options)),window.removeEventListener("keydown",this.keydownActions)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{id:"options"},r.a.createElement(w,{active:this.state.modalActive,message:"Push on touch on your keyboard !"}),r.a.createElement("h1",null,"Options"),r.a.createElement("p",{className:"description"},"For change option, click on shape and press you favorite touch"),r.a.createElement("h2",null,"Liste des options"),Object.keys(this.state.options.touch).map(function(t){return r.a.createElement("button",{className:"option "+t,onClick:function(){return e.updateTouch(t)},key:"touch_"+t},r.a.createElement("span",{className:"shape"}),r.a.createElement("span",{className:"touch"},t," (",e.state.options.touch[t],")"))}),r.a.createElement("h2",null,"Liste des helpers"),Object.keys(this.state.options.helpers).map(function(t){return r.a.createElement("button",{className:"option "+t,onClick:function(){return e.updateHelper(t)},key:"helper_"+t},r.a.createElement("span",{className:"shape"}),r.a.createElement("span",{className:"shape2"}),r.a.createElement("span",{className:"touch"},t," (",!0===e.state.options.helpers[t]?"ON":"OFF",")"))}),r.a.createElement("button",{className:"back",onClick:function(){return e.props.actions.launchMenu()}},"Back"))}}]),t}(a.Component)),N=n(8),T=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={componentToLoaded:null,actions:null},n.launchGame=function(){n.setState({componentToLoaded:b,actions:{launchMenu:function(){return n.launchMenu()}}})},n.launchOptions=function(){n.setState({componentToLoaded:L,actions:{launchMenu:function(){return n.launchMenu()}}})},n.launchMenu=function(){n.setState({componentToLoaded:d,actions:{launchGame:function(){return n.launchGame()},launchOptions:function(){return n.launchOptions()}}})},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.launchMenu(),N.a.initialize("UA-114649554-2"),N.a.pageview(window.location.pathname+window.location.search)}},{key:"render",value:function(){return r.a.createElement("div",{id:"wrapper_tetris"},null!==this.state.componentToLoaded&&r.a.createElement(this.state.componentToLoaded,{actions:this.state.actions}))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(T,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[12,1,2]]]);
//# sourceMappingURL=main.4b65f92c.chunk.js.map